# TryHackMe - Active Directory Basics
[https://tryhackme.com/room/winadbasics](https://tryhackme.com/room/winadbasics)

## Active Directory
- ユーザなどの権限などを一括管理するためのWindowsの仕組み
- ドメインコントローラーで管理される
- アクティブディレクトリーはユーザの権利やグループのメンバーなどを管理するDBのようなものがあり
- ドメインコントローラーがその情報をもとに認証とかを処理する

## Active Directory Domain Service (AD DS).
- ユーザ、PC、セキュリティグループを分けれるもの
- ユーザはログインの情報だったり
- ユーザだけではなくPCも登録する必要があるのは、windowsアプデなどの自動でやっておきたいことをAD経由で行えるようにするため
- セキュリティグループはどのユーザ、PCにどんなリソースへのアクセス権限を与える、を管理するもの。GCPのIAMみたいな
  - セキュリティグループは複数割り当て可能。ファイル群Aの権限とファイル群Bの権限あげるよ、みたいな
- Organizational Units(OU)は単純に、どの会社の部署のどの人、みたいなのを分けるよう。
  - これはユーザ1に対して1つしか割り当てれない。
  - OUは入れ子の構造にできていろんな細分化が可能
- TOM-PCのようなマシンにはTOM-PC$のマシンアカウントが存在する

## 委任
- OUの削除を行う場合、詳細情報からプロパティを見て誤削除防止のチェックを外す必要あり
- セキュリティポリシーを使ってOUの管理を委任することも可能
- その場合は、委任の設定からユーザを選択して、どの権限を付与するを宣言できる
- 例えば営業のOUは営業部長のAさんに、ユーザの追加、更新、削除の権限を与える。など

## Group Policy Management（GPM）
- OUごとに設定する制限のこと。これがあるのでOUは厳密に分けるべき
- パスワードポリシー、画面ロック、コントロールパネルの制限
- Group Policy Manager Editerで変更可能
- SYSVOLのネットワーク共有を介して定期的に更新されていくもの
- ポリシー変更があると、他のコンピュータへの変更が反映されていき２時間くらいで終わる
- 対象のPCで手動で取得しにいくこともできる

## 認証方法
- Windowsドメインでは、ユーザーがログインしたり、ネットワークサービス（共有フォルダ・Web・DBなど）を使うときに認証が必要
- Kerberos
  - 最初の通信で暗号化して通信し鍵を作ってもらう、以降それを使って許可する
  - 暗号化してて安全、一度鍵ができると何回でもアクセスできる
  - 共通かぎっぽい
- NetNTLM
  - チャレンジアクセスで乱数を受け取り、決まったルールで暗号化複合化をすることで本人であることを確かめる仕組み
  - メールの公開鍵暗号方式みたい

## ツリーとフォレストの概念
- 単一のドメインで管理できない場合は、サブドメインを切って管理する
- その場合オリジンのドメインとサブドメインそれぞれにDCが存在する。親会社と子会社みたいなイメージ。これをツリーという
- ツリーをくっつけることもできる。イメージは会社の合併など。別のドメインがアクセス可能になる。これをフォレスト
- 管理者権限はツリー内でのみの管理者と、フォレストをまたぐ管理者も設定可能。双方向や一方向もあり